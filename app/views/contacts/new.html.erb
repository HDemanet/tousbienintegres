<!-- app/views/contacts/new.html.erb -->
<% set_meta_tags title: 'Contact',
                  description: 'Contactez l\'équipe Tous bien intégrés - Liste MoDem pour les élections consulaires 2026.' %>

<section class="page-header-simple">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h1>Contactez-nous</h1>
        <p class="lead mb-0">
          Nous sommes à votre écoute
        </p>
      </div>
    </div>
  </div>
</section>

<section class="py-5">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">

        <p class="lead mb-5">
          Une question ? Une suggestion ? N'hésitez pas à nous contacter,
          nous vous répondrons dans les meilleurs délais.
        </p>

        <!-- Messages d'erreur -->
        <% if @contact&.errors&.any? %>
          <div class="alert alert-danger" role="alert" id="error-summary" tabindex="-1">
            <h2 class="h5 alert-heading">
              <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
              <%= pluralize(@contact.errors.count, "erreur") %> à corriger
            </h2>
            <ul class="mb-0">
              <% @contact.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%= form_with model: @contact, url: contacts_path, local: true,
                      html: { class: "needs-validation", novalidate: false, id: "contact-form" } do |f| %>

          <div class="mb-3">
            <%= f.label :name, class: "form-label" do %>
              Nom complet <abbr title="Champ requis" class="text-danger">*</abbr>
            <% end %>
            <%= f.text_field :name,
                             class: "form-control #{@contact&.errors&.[](:name)&.any? ? 'is-invalid' : ''}",
                             required: true,
                             'aria-required': 'true',
                             'aria-describedby': @contact&.errors&.[](:name)&.any? ? 'name_error name_help' : 'name_help',
                             placeholder: "Prénom Nom" %>
            <div id="name_help" class="form-text">Votre nom et prénom</div>
            <% if @contact&.errors&.[](:name)&.any? %>
              <div class="invalid-feedback" id="name_error">
                <%= @contact.errors[:name].first %>
              </div>
            <% end %>
          </div>

          <div class="mb-3">
            <%= f.label :email, class: "form-label" do %>
              Email <abbr title="Champ requis" class="text-danger">*</abbr>
            <% end %>
            <%= f.email_field :email,
                              class: "form-control #{@contact&.errors&.[](:email)&.any? ? 'is-invalid' : ''}",
                              required: true,
                              'aria-required': 'true',
                              'aria-describedby': @contact&.errors&.[](:email)&.any? ? 'email_error email_help' : 'email_help',
                              placeholder: "votre.email@exemple.com" %>
            <div id="email_help" class="form-text">Nous vous répondrons à cette adresse</div>
            <% if @contact&.errors&.[](:email)&.any? %>
              <div class="invalid-feedback" id="email_error">
                <%= @contact.errors[:email].first %>
              </div>
            <% end %>
          </div>

          <div class="mb-3">
            <%= f.label :subject, class: "form-label" do %>
              Sujet <abbr title="Champ requis" class="text-danger">*</abbr>
            <% end %>
            <%= f.text_field :subject,
                             class: "form-control #{@contact&.errors&.[](:subject)&.any? ? 'is-invalid' : ''}",
                             required: true,
                             'aria-required': 'true',
                             'aria-describedby': @contact&.errors&.[](:subject)&.any? ? 'subject_error' : nil,
                             placeholder: "Objet de votre message" %>
            <% if @contact&.errors&.[](:subject)&.any? %>
              <div class="invalid-feedback" id="subject_error">
                <%= @contact.errors[:subject].first %>
              </div>
            <% end %>
          </div>

          <div class="mb-4">
            <%= f.label :message, class: "form-label" do %>
              Message <abbr title="Champ requis" class="text-danger">*</abbr>
            <% end %>
            <%= f.text_area :message,
                            rows: 8,
                            class: "form-control #{@contact&.errors&.[](:message)&.any? ? 'is-invalid' : ''}",
                            required: true,
                            'aria-required': 'true',
                            'aria-describedby': @contact&.errors&.[](:message)&.any? ? 'message_error message_help' : 'message_help',
                            placeholder: "Votre message..." %>
            <div id="message_help" class="form-text">Minimum 10 caractères</div>
            <% if @contact&.errors&.[](:message)&.any? %>
              <div class="invalid-feedback" id="message_error">
                <%= @contact.errors[:message].first %>
              </div>
            <% end %>
          </div>

          <!-- Consentement RGPD -->
          <div class="mb-4">
            <div class="form-check">
              <%= f.check_box :consent,
                              class: "form-check-input #{@contact&.errors&.[](:consent)&.any? ? 'is-invalid' : ''}",
                              required: true,
                              'aria-required': 'true',
                              'aria-describedby': @contact&.errors&.[](:consent)&.any? ? 'consent_error' : nil,
                              id: "contact_consent" %>
              <%= f.label :consent, class: "form-check-label", for: "contact_consent" do %>
                J'accepte que mes données soient utilisées pour traiter ma demande conformément
                à la <%= link_to "politique de confidentialité", privacy_path, target: "_blank" %>. <abbr title="Champ requis" class="text-danger">*</abbr>
              <% end %>
              <% if @contact&.errors&.[](:consent)&.any? %>
                <div class="invalid-feedback" id="consent_error">
                  <%= @contact.errors[:consent].first %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Submit -->
          <div class="d-flex gap-3 flex-wrap">
            <%= f.submit "Envoyer", class: "btn btn-primary btn-lg" %>
            <%= link_to "Retour", root_path, class: "btn btn-outline-secondary btn-lg" %>
          </div>

          <p class="mt-4 text-muted small">
            <abbr title="Champ requis" class="text-danger">*</abbr> Champs obligatoires
          </p>

        <% end %>

      </div>
    </div>
  </div>
</section>

<!-- JavaScript pour scroll vers erreurs -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const errorSummary = document.getElementById('error-summary');
  if (errorSummary) {
    errorSummary.focus();
    errorSummary.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
});
</script>
